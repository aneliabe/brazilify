<div class="container categories-page" style="max-width:1100px;margin:2rem auto;">
  <h1 class="page-title mb-3">Categorias de serviços</h1>

  <div data-controller="categories">
    <div class="row g-3">
      <% @categories.each do |category| %>
        <div class="col-12 col-md-6">
          <div class="glass-card category-card">
            <!-- header button (fires your Stimulus toggle) -->
            <button type="button"
                    class="category-toggle"
                    data-action="click->categories#toggle"
                    aria-expanded="false">
              <span class="dot"></span>
              <span class="name"><%= category.name %></span>
              <span class="count"><%= category.services.size %></span>
              <i class="fa-solid fa-chevron-down ms-auto chevron"></i>
            </button>

            <!-- services list (keeps your target + inline display so no JS change) -->
            <div class="services" data-categories-target="services" style="display:none;">
              <div class="chips">
<% category.services.order(:name).each do |service| %>
  <%= link_to service.name,
              search_path(
                category_id: category.id,   # ← Add this line
                service_id: service.id,
                city: current_user&.city || params[:city] || "cache"
              ),
              class: "chip chip-link" %>
<% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
