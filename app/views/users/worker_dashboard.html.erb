<div class="container dashboard" style="max-width:1100px;margin:2rem auto;">

  <!-- Header: avatar + name + quick actions -->
  <div class="glass-card p-3 p-md-4 mb-3">
    <div class="d-flex align-items-center gap-3 flex-wrap">
                <%= if current_user.photo.attached?
                cl_image_tag current_user.photo.key,
                  width: 56, height: 56, dpr: 2, crop: :fill, gravity: :face,
                  quality: "auto", fetch_format: "auto",
                  class: "dropdown-toggle rounded-circle ms-md-auto", id: "navbarDropdown",
                  role: "button", data: { bs_toggle: "dropdown" },
                  aria: { haspopup: "true", expanded: "false" }, style: "object-fit:cover;"
              else
                image_tag "default-avatar.png",
                  width: 56, height: 56,
                  class: "dropdown-toggle rounded-circle ms-md-auto", id: "navbarDropdown",
                  role: "button", data: { bs_toggle: "dropdown" },
                  aria: { haspopup: "true", expanded: "false" }, style: "object-fit:cover;"
              end %>

      <div class="flex-grow-1 min-w-0">
        <h1 class="h4 m-0 text-truncate">Meu Dashboard</h1>
        <div class="text-muted small mt-1">
          <i class="fa-solid fa-user"></i> <%= @user.full_name %>
          <% if [@user.city, @user.country].compact.any? %>
            • <i class="fa-solid fa-location-dot"></i> <%= [@user.city, @user.country].compact.join(", ") %>
          <% end %>
          <% if (wp = @user.try(:worker_profile)) %>
            • <i class="fa-solid fa-star text-warning"></i>
            <%= wp.average_rating %> (<%= wp.reviews.count %> avaliações)
          <% end %>
        </div>
      </div>

      <div class="d-flex gap-2 ms-auto">
        <%= link_to "Meus agendamentos", my_appointments_path, class: "btn btn-primary" %>
        <%= link_to "Editar perfil", edit_worker_user_path(@user), class: "btn btn-outline-primary" %>
      </div>
    </div>
  </div>

  <div class="row g-3">
    <!-- Serviços oferecidos -->
    <div class="col-12 col-lg-6">
      <div class="glass-card p-3 p-md-4 h-100">
        <h2 class="h6 fw-bold mb-2">Serviços oferecidos</h2>

        <% if @user.role == "worker" && @worker_services.present? %>
          <div class="chips">
            <% @worker_services.each do |ws| %>
              <span class="chip d-inline-flex align-items-center gap-1">
                <i class="fa-solid fa-briefcase"></i>
                <span class="text-truncate">
                  <%= ws.category.name %> • <strong><%= ws.service.name %></strong>
                </span>
                <span class="badge badge-soft ms-1"><%= ws.service_type.humanize %></span>
              </span>
            <% end %>
          </div>
        <% else %>
          <p class="text-muted m-0">Nenhum serviço cadastrado.</p>
        <% end %>
      </div>
    </div>

    <!-- Dados do prestador -->
    <div class="col-12 col-lg-6">
      <div class="glass-card p-3 p-md-4 h-100">
        <h2 class="h6 fw-bold mb-2">Informações do prestador</h2>

        <dl class="info-grid">
          <div><dt>Nome completo</dt><dd><%= @user.full_name %></dd></div>
          <div><dt>Data de nascimento</dt><dd><%= @user.birth_date.presence || "—" %></dd></div>
          <div><dt>Endereço</dt><dd><%= @user.address.presence || "—" %></dd></div>
          <div><dt>Cidade</dt><dd><%= @user.city.presence || "—" %></dd></div>
          <div><dt>País</dt><dd><%= @user.country.presence || "—" %></dd></div>
          <div><dt>Código do país</dt><dd><%= @user.country_code.presence || "—" %></dd></div>
          <div><dt>Telefone</dt><dd><%= @user.phone.presence || "—" %></dd></div>
          <div><dt>Email</dt><dd><%= @user.email %></dd></div>
        </dl>
      </div>
    </div>
  </div>
</div>
