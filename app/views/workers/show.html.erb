<div class="worker-show">
  <div class="card worker-card">
    <div class="worker-header">
      <img src="<%= @worker.user.avatar.presence || 'https://placehold.co/96x96' %>" class="worker-avatar" alt="">
      <div class="worker-headings">
        <h2 class="worker-name"><%= @worker.user.full_name %></h2>
        <small class="worker-sub">
          <i class="fa-solid fa-location-dot"></i>
          <%= [@worker.user.city, @worker.user.country].compact.join(", ") %>
        </small>
        <div class="worker-stats">
          <i class="fa-solid fa-star"></i>
          <span><%= @worker.average_rating %> (<%= @worker.reviews.count %> avalia√ß√µes)</span>
        </div>
      </div>
    </div>

    <p class="worker-desc"><%= @worker.description %></p>

    <div class="worker-tags">
      <% if @worker.services.any? %>
        <% @worker.services.each do |s| %>
          <span class="tag"><%= s.name %></span>
        <% end %>
      <% else %>
        <small>Sem servi√ßos cadastrados ainda.</small>
      <% end %>
    </div>

    <hr class="divider">

    <div class="worker-cta">
      <h3>Solicitar hor√°rio com <%= @worker[:name] %></h3>

      <button type="button" class="see-all-btn" data-bs-toggle="modal" data-bs-target="#requestTimeModal">
        Solicitar hor√°rio
      </button>

      <p class="hint">
        Voc√™ escolhe a data/hora preferida. O profissional confirma ou sugere outro.
      </p>
    </div>
    <!-- üîÑ CHANGE ENDS HERE -->
  </div>
</div>

<!-- ‚úÖ NEW: Modal with form -->
<div class="modal fade" id="requestTimeModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Solicitar hor√°rio</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>

      <div class="modal-body">
        <%= form_with url: worker_appointments_path(@worker), method: :post, html: { class: "appointment-request-form" } do %>
          <div class="mb-3">
            <label class="form-label">Dia e hora</label>
            <input
              type="text"
              name="appointment[starts_at]"
              id="appointment_starts_at"
              class="form-control"
              placeholder="Selecione dia e hora"
              autocomplete="off"
              <%# data-controller="flatpickr" %>
              data-flatpickr-enable-time-value="true"
              data-flatpickr-time-24hr-value="true"
              data-flatpickr-minute-increment-value="15"
              data-flatpickr-date-format-value="Y-m-d H:i"
            >
            <small class="text-muted">Voc√™ poder√° combinar a dura√ß√£o no chat.</small>
          </div>

          <div class="mb-3">
            <label class="form-label">Mensagem (opcional)</label>
            <textarea name="message" class="form-control" rows="3" placeholder="Descreva o servi√ßo, endere√ßo/online, urg√™ncia‚Ä¶"></textarea>
          </div>

          <div class="d-grid">
            <button type="submit" class="btn btn-primary">Enviar solicita√ß√£o</button>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
